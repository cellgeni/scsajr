% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{get_dpsi}
\alias{get_dpsi}
\title{Compute delta‐PSI (difference in percent spliced‐in) per segment}
\usage{
get_dpsi(data, groupby, min_cov = 50)
}
\arguments{
\item{data}{A \code{SummarizedExperiment} where rows are segments and columns are single‐cell or pseudobulk samples.
Must contain assays \code{i} (inclusion) and \code{e} (exclusion) so that \code{calc_psi()} works after pseudobulking.}

\item{groupby}{Either:
\itemize{
\item A character vector of length \code{ncol(data)} giving a grouping label for each column, or
\item One or more column names in \code{colData(data)}, whose values (pasted if multiple) define the grouping factor.
See \code{get_groupby_factor()} for details.
}}

\item{min_cov}{Integer; minimum total junction coverage (\code{i + e}) per pseudobulk required to compute a valid PSI.
PSI values where \code{i + e < min_cov} are set to \code{NA}. Default is 50.}
}
\value{
A data.frame with one row per segment (rownames = \code{rownames(data)}), containing columns:
\itemize{
\item \code{low_state}: group label with lowest mean PSI (or \code{NA} if fewer than two non‐NA values),
\item \code{high_state}: group label with highest mean PSI,
\item \code{dpsi}: numeric difference \code{PSI[high_state] - PSI[low_state]} (or \code{NA} if not computable).
}
}
\description{
For a \code{SummarizedExperiment} of splicing segments, this function first pseudobulks the data by \code{groupby},
computes PSI per segment (using \code{calc_psi()}), and then identifies for each segment
the group with lowest mean PSI (\code{low_state}),  the group with highest mean PSI (\code{high_state}), and their difference (\code{dpsi}).
}
\details{
\enumerate{
\item The function calls \code{pseudobulk(data, groupby)}, which sums counts per group.
\item It then computes a PSI matrix via \code{calc_psi()} on the pseudobulk, obtaining one PSI value per segment × group.
\item For each segment (row of the PSI matrix):
\itemize{
\item Extracts non‐\code{NA} PSI values, sorts them by ascending PSI.
\item If at least two groups have non‐\code{NA} PSI, sets \code{low_state} to the name of the group with smallest PSI,
\code{high_state} to the group with largest PSI, and \code{dpsi = PSI[high_state] - PSI[low_state]}.
\item Otherwise, leaves all three as \code{NA}.
}
}
}
\seealso{
\code{\link{pseudobulk}}, \code{\link{calc_psi}}
}
