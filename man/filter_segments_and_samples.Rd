% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{filter_segments_and_samples}
\alias{filter_segments_and_samples}
\title{Filter segments and samples based on coverage and group criteria}
\usage{
filter_segments_and_samples(
  pbas,
  sample_filter = TRUE,
  sites = c("ad", "aa", "dd"),
  min_cov = 10,
  sample_min_ncells = 20,
  celltype_min_samples = 2,
  seg_min_samples = 4,
  seg_min_samples_fraq = 0.2,
  seg_min_sd = 0.1,
  groupby = "celltype"
)
}
\arguments{
\item{pbas}{A \code{SummarizedExperiment} where each row is a segment and each column is a pseudobulk.
Must contain assays named “i” (inclusion) and “e” (exclusion).
Rows correspond to segments; columns correspond to samples/pseudobulks.}

\item{sample_filter}{Logical vector (length = number of columns in \code{pbas}) indicating which samples to retain initially.
Defaults to \code{TRUE} for all samples.}

\item{sites}{Character vector of splice‐site patterns to keep (e.g., \code{c("ad", "aa", "dd")}). Only segments whose \code{rowData(pbas)$sites} is in this set will be retained.}

\item{min_cov}{Minimum total junction coverage (\code{i + e}) for a pseudobulk to count toward segment inclusion. Default 10.}

\item{sample_min_ncells}{Minimum number of cells per pseudobulk; pseudobulk samples with fewer cells are filtered out. Default 20.}

\item{celltype_min_samples}{Minimum number of pseudobulk samples per group (as defined by \code{groupby}) to keep that group. Default 2.}

\item{seg_min_samples}{The absolute minimum number of pseudobulks (after filtering by \code{min_cov}) that a segment must be observed in. Default 4.}

\item{seg_min_samples_fraq}{Minimum fraction of total pseudobulk samples that must meet \code{min_cov} for a segment to be retained. Default 0.2.
The effective minimum samples per segment is \code{max(seg_min_samples, ncol(pbas) * seg_min_samples_fraq)}.}

\item{seg_min_sd}{Minimum standard deviation of PSI (percent spliced‐in) across pseudobulks for a segment to be retained. Default 0.1.}

\item{groupby}{Either (a) a character vector of length \code{ncol(pbas)} giving an existing grouping factor for each column, or
(b) a character scalar or vector of column names in \code{colData(pbas)} whose pasted‐together values define the grouping factor.
See \code{\link{get_groupby_factor}} for details.}
}
\value{
A filtered \code{SummarizedExperiment}, containing only those pseudobulks and segments that satisfy all criteria.
The returned object will always have assays “i”, “e” converted to dense matrices, and will include a “psi” assay (percent spliced‐in) for each retained segment/samples.
The \code{rowData} will also contain a column “nna” (number of pseudobulks with \code{i+e >= min_cov}) and “sd” (standard deviation of PSI).
}
\description{
This function takes a \code{SummarizedExperiment} containing alternative splicing data
(with assays “i” for inclusion counts and “e” for exclusion counts), and filters out:
\enumerate{
\item pseudobulk samples with fewer than \code{sample_min_ncells} cells,
\item cell‐type groups with fewer than \code{celltype_min_samples} samples,
\item segments (rows) that do not meet minimum coverage across pseudobulks,
\item segments with low variability (standard deviation of PSI).
}
}
\examples{
\dontrun{
data(pbas)
filtered_se <- filter_segments_and_samples(
  pbas = pbas,
  sample_filter = TRUE,
  sites = c("ad", "aa", "dd"),
  min_cov = 10,
  sample_min_ncells = 20,
  celltype_min_samples = 2,
  seg_min_samples = 4,
  seg_min_samples_fraq = 0.2,
  seg_min_sd = 0.1,
  groupby = "celltype"
)
head(filtered_se)
}
}
