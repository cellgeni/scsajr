% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{fit_as_glm}
\alias{fit_as_glm}
\title{Fit a quasi‐binomial GLM for alternative splicing per segment}
\usage{
fit_as_glm(
  pbas,
  formula,
  data_terms,
  pseudocount = 0,
  parallel = FALSE,
  progress = "none",
  return_pv = FALSE,
  overdisp = TRUE,
  disp_param = NULL
)
}
\arguments{
\item{pbas}{A \code{SummarizedExperiment} where each row is a segment and each column is a pseudobulk.
Must contain assays named “i” (inclusion) and “e” (exclusion).
Rows correspond to segments; columns correspond to samples/pseudobulks.}

\item{formula}{An \code{\link[stats]{formula}} object specifying the model, e.g., \code{i ~ group}.
Internally, the function treats “i” and “e” as a two‐column response.}

\item{data_terms}{A named list of covariates: data.frame columns referenced in \code{formula}.
For example, if \code{formula = i ~ group}, then \code{data_terms = list(group = group_factor)} where \code{group_factor} is a vector of length \code{ncol(pbas)}.}

\item{pseudocount}{A numeric fraction of each count total to add to both “i” and “e”, expressed as a fraction of the total counts. Default 0 (no pseudocount).}

\item{parallel}{Logical; if \code{TRUE}, uses \code{\link[plyr]{alply}(…, .parallel = TRUE)} to fit models in parallel (requires registered backend). Default \code{FALSE}.}

\item{progress}{Character string passed to \code{.progress} in \code{\link[plyr]{alply}}. Default \code{"none"}.}

\item{return_pv}{Logical; if \code{TRUE}, perform a quasi‐likelihood ratio test per segment to return p‐values for each term in \code{formula}.
Otherwise, return fitted \code{\link[stats]{glm}} objects. Default \code{FALSE}.}

\item{overdisp}{Logical; if \code{TRUE}, account for overdispersion when computing test statistics. Default \code{TRUE}.}

\item{disp_param}{Optional numeric vector of length \code{nrow(pbas)} providing dispersion parameters per segment.
If \code{NULL}, dispersion is estimated from each model’s residuals.}
}
\value{
If \code{return_pv = FALSE}, a named list of length \code{nrow(pbas)} of fitted \code{glm} objects
(or \code{NA} for segments where fitting failed). Names correspond to \code{rownames(pbas)}.
If \code{return_pv = TRUE}, a data.frame with one row per segment, columns:
\describe{
\item{overdispersion}{Estimated dispersion (or provided \code{disp_param}).}
\item{\if{html}{\out{<term>}}}{Likelihood‐ratio p‐value for each term in \code{formula}.}
}
Row names correspond to \code{rownames(pbas)}.
}
\description{
For each segment (row) in a \code{SummarizedExperiment} with assays “i” (inclusion counts) and “e” (exclusion counts),
this function fits a quasi‐binomial generalized linear model of the form \code{i / (i + e) ~ predictors},
adding a pseudocount if desired. It can optionally return p‐values via a likelihood‐ratio test.
}
\details{
The function loops over each segment, constructs a two‐column matrix \code{cbind(i, e)}, adds pseudocounts if requested, and fits a quasi‐binomial \code{\link[stats]{glm}}.
If \code{return_pv = TRUE}, it calls \code{\link{asq_lrt}} to compute a likelihood‐ratio test for each term in \code{formula}.
Any errors or warnings during fitting are caught; segments with fitting errors return \code{NA}.
}
\seealso{
\code{\link{asq_lrt}}, \code{\link[stats]{glm}}, \code{\link[plyr]{alply}}
}
