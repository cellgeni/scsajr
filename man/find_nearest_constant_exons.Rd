% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{find_nearest_constant_exons}
\alias{find_nearest_constant_exons}
\title{Find nearest constitutive exons for a given segment}
\usage{
find_nearest_constant_exons(se, sid, psi_thr = 0.95)
}
\arguments{
\item{se}{A \code{SummarizedExperiment} where \code{rowRanges(se)} has metadata columns:
\code{gene_id}, \code{start}, \code{end}, \code{strand}, and \code{sites}.
The assays \code{i} and \code{e} are used to compute summed PSI.}

\item{sid}{Character; the segment ID (rownames of \code{se}) for which to find nearest exons.}

\item{psi_thr}{Numeric between 0 and 1; constant exons are those where
\verb{sum(i) / (sum(i) + sum(e)) ≥ psi_thr} or are \code{NA}. Default is \code{0.95}.}
}
\value{
A named character vector of length 2, with names:
\itemize{
\item \code{up}: the segment ID of the nearest upstream constant exon (or \code{NA} if none),
\item \code{down}: the segment ID of the nearest downstream constant exon (or \code{NA} if none).
}
}
\description{
Within a \code{SummarizedExperiment} of segments, this function identifies the nearest
upstream and downstream “constant” exons (segments) for a given segment ID (\code{sid}).
A constant exon is defined as one where the overall PSI (summed across all samples) is \code{NA} or ≥ \code{psi_thr}.
The search is restricted to segments belonging to the same gene.
}
\details{
\enumerate{
\item Subset \code{se} to only segments belonging to the same gene as \code{sid}.
\item Compute summed inclusion (\code{i_sum}) and exclusion (\code{e_sum}) counts across all samples:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{i_sum <- rowSums(assay(se, "i")[same_gene, , drop = FALSE])
e_sum <- rowSums(assay(se, "e")[same_gene, , drop = FALSE])
psi_all <- i_sum / (i_sum + e_sum)
}\if{html}{\out{</div>}}

Any segment with \verb{psi_all ≥ psi_thr} or \code{is.na(psi_all)} is considered “constant.”
\item Among constant segments, define:
\itemize{
\item “up” candidates: \code{sites} ∈ \code{c("ad", "sd")}
\item “down” candidates: \code{sites} ∈ \code{c("ad", "ae")}
}
\item Order segments by genomic coordinate (\code{start}) in the gene’s transcriptional direction:
\itemize{
\item If \code{strand == "-"}, use descending \code{start}; otherwise ascending.
}
\item Find the position of \code{sid} in that ordered list, then select the nearest constant exon
before (\code{up}) and after (\code{down}) in that order.
\item If the gene’s strand is negative (\code{"-"}), swap the \code{up} and \code{down} results in the final output.
}
}
\seealso{
\code{\link{plot_segment_coverage}}, \code{\link{get_dpsi}}
}
