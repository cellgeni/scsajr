% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{select_all_markers}
\alias{select_all_markers}
\title{Select combined marker segments from per‐group and all‐groups tests}
\usage{
select_all_markers(
  markers,
  all_celltype_df,
  n = Inf,
  fdr_thr = 0.05,
  dpsi_thr = 0.1
)
}
\arguments{
\item{markers}{A list containing numeric matrics \code{pv}, \code{fdr}, and \code{dpsi},
each a matrix with rows = segments and columns = group labels (as returned by \code{find_marker_as()}).
\describe{
\item{\code{markers$pv}}{Matrix of raw p‐values, dimensions: ∣segments∣ × ∣groups∣.}
\item{\code{markers$fdr}}{Matrix of Benjamini‐Hochberg adjusted FDR p‐values, same dimensions.}
\item{\code{markers$dpsi}}{Matrix of delta‐PSI (mean PSI(group) – mean PSI(others)), same dimensions.}
}}

\item{all_celltype_df}{A data.frame (rownames = segment IDs) (output of \code{test_all_groups_as()}), containing columns:
\describe{
\item{overdispersion}{Estimated dispersion from each segment’s GLM.}
\item{group}{Raw p‐value from the likelihood‐ratio test for the \code{group} term.}
\item{group_fdr}{Benjamini‐Hochberg adjusted FDR (across all segments).}
\item{low_state}{Group label with lowest mean PSI (from \code{get_dpsi()}).}
\item{high_state}{Group label with highest mean PSI.}
\item{dpsi}{Difference in mean PSI between \code{high_state} and \code{low_state}.}
}}

\item{n}{Integer: maximum number of markers to return per cell type (after combining) (default: \code{Inf} (no limit)).}

\item{fdr_thr}{Numeric: false discovery rate cutoff (default: 0.05).}

\item{dpsi_thr}{Numeric: minimum absolute delta PSI cutoff (default: 0.1).}
}
\value{
A data.frame with one row per selected segment, containing:
\describe{
\item{\code{pv}}{Raw p‐value (from either per‐group or all‐groups test).}
\item{\code{fdr}}{Adjusted FDR (from the same test).}
\item{\code{dpsi}}{Delta‐PSI (for the group that nominated this segment).}
\item{\code{seg_id}}{Segment IDs (rownames).}
\item{\code{group}}{Group label for which the segment is selected.}
\item{\code{is_marker}}{Logical: \code{TRUE} if selected by the per‐group test, \code{FALSE} if only from the all‐groups test.}
}
Row names are the segment IDs. Rows are ordered within each group by descending |dpsi| and limited to \code{n} per group.
}
\description{
This function merges two sets of marker results:
\enumerate{
\item Per‐group markers (output of \code{select_markers}): segments deemed significant in one‐vs‐rest tests.
\item All‐groups markers (output of \code{select_markers_from_all_celltype_test}): segments significant across all groups.
}
}
\details{
For each group, it prioritizes segments identified by one‐vs‐rest tests; any segment not already selected but significant in the all‐groups test is labeled as a “background” marker.
The result contains at most \code{n} segments per group, with ties broken by largest |dpsi|.
\enumerate{
\item Per‐group markers (priority):
Call \code{select_markers(markers, n = Inf, fdr_thr = fdr_thr, dpsi_thr = dpsi_thr, clean_duplicates = TRUE)}
to gather all segments that pass thresholds in any group. Label these as \code{is_marker = TRUE}.
\item All‐groups markers (background):
Call \code{select_markers_from_all_celltype_test(all_celltype_df, fdr_thr = fdr_thr, dpsi_thr = dpsi_thr)}
to gather segments passing the all‐groups thresholds. Exclude any segment already in step 1. Label remaining as \code{is_marker = FALSE}.
\item Combine and trim:
For each group, among combined rows (priority first), keep at most \code{n} segments ranked by descending |dpsi|.
}
}
\seealso{
\code{\link{select_markers}}, \code{\link{select_markers_from_all_celltype_test}}
}
