% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scsajr.R
\name{pseudobulk}
\alias{pseudobulk}
\title{Aggregate single-cell counts into pseudobulk per group}
\usage{
pseudobulk(se, groupby, clean_derivatives = c("psi", "cpm"))
}
\arguments{
\item{se}{\code{SummarizedExperiment}: rows are features (e.g., segments) and columns are individual cells or barcodes.
Assays include \code{i}, \code{e}, \code{counts}, etc.}

\item{groupby}{Either:
\itemize{
\item Vector of length \code{nrow(x)} or \code{ncol(x)} (for \code{SummarizedExperiment}): treated as the grouping factor directly.
\item Character scalar or vector of column names in \code{x} (or in \code{colData(x)} if \code{x} is a \code{SummarizedExperiment}):
those columns are concatenated row-wise (using \code{paste()} or \code{interaction()}) to form a grouping factor.
See \code{\link{get_groupby_factor}} for details.
}}

\item{clean_derivatives}{Character vector of assay names to remove before summation
(e.g., \code{c("psi", "cpm")}). Default \code{c("psi", "cpm")}.}
}
\value{
\code{SummarizedExperiment}:
\itemize{
\item \code{Assays}: Each assay from \code{se}, except those in \code{clean_derivatives}, replaced by a matrix of summed values per group
\item \code{rowRanges}: Copied from \code{rowRanges(se)}
\item \code{colData}: A data.frame of group-level metadata: one row per group, including any columns from \code{colData(se)}
that are constant within each group, plus aggregated columns via \code{pseudobulk_metadata()}
}
}
\description{
Given a \code{SummarizedExperiment} of single-cell assays (e.g., inclusion/exclusion counts),
this function sums counts within each group (as defined by \code{groupby}), removes specified derivative assays,
and returns a new \code{SummarizedExperiment} where each column corresponds to a group-level pseudobulk.
}
\details{
\enumerate{
\item Converts \code{groupby} into a grouping vector via \code{\link{get_groupby_factor}}.
\item Drops any assays listed in \code{clean_derivatives} from \code{se}.
\item For each remaining assay, uses \code{\link[visutils]{calcColSums}} to sum counts for columns that share the same
group label.
\item Builds a metadata data.frame by calling \code{pseudobulk_metadata(colData(se), groupby)}, which:
\enumerate{
\item Splits \code{colData(se)} into sub-data.frames by group.
\item For each group, retains columns that are constant across cells and applies aggregation functions
(e.g., sum of \code{ncells}) for specified columns.
\item Recombines group-level rows into a single data.frame, with row names matching group labels.
}
\item Constructs a new \code{SummarizedExperiment} with summed assay matrices, original \code{rowRanges(se)}, and
the aggregated \code{colData} (one row per group).
}
}
\seealso{
\code{\link{get_groupby_factor}}, \code{\link{pseudobulk_metadata}}, \code{\link[visutils]{calcColSums}}
}
